
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>2023-04-Unit42-Wireshark-quiz | Arcueid&#39;s BLOG</title>
    <meta name="author" content="Arcueid" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <link rel="icon" href="/images/Arcueid.png" />
    <link rel="preconnect" href="https://cdn.staticfile.net" />
<script src="https://cdn.staticfile.net/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://cdn.staticfile.net/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.loli.net" />
<link rel="preconnect" href="https://gstatic.loli.net" crossorigin />
<link rel="stylesheet" href="https://fonts.loli.net/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap" />
<script> const mixins = {}; </script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>


<script src="https://cdn.staticfile.net/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.staticfile.net/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://cdn.staticfile.net/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>


<script src="https://cdn.staticfile.net/KaTeX/0.16.9/katex.min.js"></script>
<script src="https://cdn.staticfile.net/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
<link rel="stylesheet" href="https://cdn.staticfile.net/KaTeX/0.16.9/katex.min.css" />
<script src="/js/lib/math.js"></script>


<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 6.3.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存 浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>ARCUEID&#39;S BLOG</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;ARCUEID&#39;S BLOG</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div class="article">
    <div>
        <h1>2023-04-Unit42-Wireshark-quiz</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/4/8
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            
            <span class="tag">
                
                <a href="/tags/flowanalysis/" style="color: #ff7d73">flowanalysis</a>
            </span>
            
        </span>
        
    </div>
    
    <div class="content" v-pre>
        <h1 id="2023-04-Unit42-Wireshark-quiz"><a href="#2023-04-Unit42-Wireshark-quiz" class="headerlink" title="2023-04-Unit42-Wireshark-quiz"></a>2023-04-Unit42-Wireshark-quiz</h1><p>下载pcap包</p>
<p><a target="_blank" rel="noopener" href="https://github.com/pan-unit42/Wireshark-quizzes/blob/main/2023-04-Unit42-Wireshark-quiz.pcap.zip">https://github.com/pan-unit42/Wireshark-quizzes/blob/main/2023-04-Unit42-Wireshark-quiz.pcap.zip</a></p>
<blockquote>
<p>  Quiz Questions</p>
<ul>
<li>What is the date and time in UTC the infection started?</li>
<li>What is the IP address of the infected Windows client?</li>
<li>What is the MAC address of the infected Windows client?</li>
<li>What is the hostname of the infected Windows client?</li>
<li>What is the user account name from the infected Windows host?</li>
<li>Is there any follow-up activity from other malware?</li>
</ul>
</blockquote>
<h1 id="事件链流程图"><a href="#事件链流程图" class="headerlink" title="事件链流程图"></a>事件链流程图</h1><p><img src="https://img-host-arcueid.oss-cn-hangzhou.aliyuncs.com/img202404081231222.png" alt="Image 1 is a flowchart of the chain of events in the April 2023 IcedID infection. It starts with email and or web-based delivery methods, continues to the IcedID installer, HTTP traffic for the gzip binary, malware created from that binary, and then command and control traffic from the IcedID infection. The initial follow-up activity can include Cobalt sStrike, VNC traffic, and BackConnect."></p>
<h1 id="分析流程"><a href="#分析流程" class="headerlink" title="分析流程"></a>分析流程</h1><p><img src="https://img-host-arcueid.oss-cn-hangzhou.aliyuncs.com/img202404081228633.png" alt="image-20240408122852449"></p>
<span id="more"></span>

<p>注意到向main.php发送了一个http请求</p>
<p>给我们重定向到</p>
<p><img src="https://img-host-arcueid.oss-cn-hangzhou.aliyuncs.com/img202404081240181.png" alt="image-20240408124022114"></p>
<p><code>https://firebasestorage.googleapis.com/v0/b/serene-cathode-377701.appspot.com/o/XSjwp6O0pq%2FScan_Inv.zip?alt=media&amp;token=a716bdce-1373-44ed-ae89-fdabafa31c61</code></p>
<p>该连接已经被google ban了</p>
<p>只能知道下载了一个zip包</p>
<p>进一步过滤web</p>
<p><code>(tls.handshake.type == 1 || http.request) &amp;&amp; (!ssdp) &amp;&amp; ip.addr==10.4.19.136</code></p>
<p><img src="https://img-host-arcueid.oss-cn-hangzhou.aliyuncs.com/img202404081250983.png" alt="image-20240408125015918"></p>
<p>追踪和firebasestorage交互的数据流</p>
<p><img src="https://img-host-arcueid.oss-cn-hangzhou.aliyuncs.com/img202404081251566.png" alt="image-20240408125113496"></p>
<p>根据数据大小 我们可以推断出应该是把zip包下下来了</p>
<p>我们可以在urlhaus上下载样本</p>
<p><img src="https://img-host-arcueid.oss-cn-hangzhou.aliyuncs.com/img202404081253104.png" alt="image-20240408125300013"></p>
<p>根据icedID的特性 受害主机先会向某域名的80端口发送无参数的GET请求gzip</p>
<p>排除微软等url 发现可疑域名</p>
<p><img src="https://img-host-arcueid.oss-cn-hangzhou.aliyuncs.com/img202404081257085.png" alt="image-20240408125730016"></p>
<p><img src="https://img-host-arcueid.oss-cn-hangzhou.aliyuncs.com/img202404081258573.png" alt="image-20240408125809508"></p>
<p>确实请求了gzip</p>
<p>受害主机的cookie中包含了主机相关信息</p>
<p>__gads IcedID 活动标识符和来自受感染主机的信息</p>
<p>_gid 使用受感染主机的 MAC 地址计算的值</p>
<p>_u ASCII 文本，表示受害者主机名、Windows 用户帐户名和另一个未确定值的十六进制值</p>
<p>__io 来自受感染主机安全标识符 (SID) 的域标识符</p>
<p>_ga 基于受感染主机CPU的信息</p>
<p>_gat windows版本</p>
<p><img src="https://img-host-arcueid.oss-cn-hangzhou.aliyuncs.com/img202404081305034.png" alt="image-20240408130520969"></p>
<p>主机名和用户名都出了</p>
<p>解压gzip后IcedId installer向C2回连 走HTTPS</p>
<p>我们注意到</p>
<p><img src="https://img-host-arcueid.oss-cn-hangzhou.aliyuncs.com/img202404081434813.png" alt="image-20240408143411773"></p>
<p><img src="https://img-host-arcueid.oss-cn-hangzhou.aliyuncs.com/img202404081447941.png" alt="image-20240408144737847"></p>
<p><img src="https://img-host-arcueid.oss-cn-hangzhou.aliyuncs.com/img202404081713286.png" alt="image-20240408171339246"></p>
<p>这几个都是恶意url</p>
<p>查看他们的证书</p>
<p><img src="https://img-host-arcueid.oss-cn-hangzhou.aliyuncs.com/img202404081718994.png" alt="image-20240408171809949"></p>
<p>发现组织名是默认的 Internet Widgits Pty Ltd</p>
<p>我们可以用wireshark过滤</p>
<p><code>x509sat.uTF8String eq &quot;Internet Widgits Pty Ltd&quot;</code></p>
<p><img src="https://img-host-arcueid.oss-cn-hangzhou.aliyuncs.com/img202404081722285.png" alt="image-20240408172204240"></p>
<p>很多恶意软件的自签名证书都是默认的数值 可以特别关注一下</p>
<p>uint42上指出IcedID常见后门ip为193.149.176.100</p>
<p>过滤查看</p>
<p><img src="https://img-host-arcueid.oss-cn-hangzhou.aliyuncs.com/img202404081751918.png"></p>
<p>一逐一查看 </p>
<p>第一个加密的没什么看的</p>
<p>第二个显示域控下所有主机 针对boogienights.live域</p>
<p><img src="https://img-host-arcueid.oss-cn-hangzhou.aliyuncs.com/img202404081752809.png" alt="image-20240408175200761"></p>
<p>第三个列了一下磁盘</p>
<p><img src="https://img-host-arcueid.oss-cn-hangzhou.aliyuncs.com/img202404081753412.png" alt="image-20240408175333338"></p>
<p>针对受害主机进行过滤 拿到受害主机用户名</p>
<p><img src="https://img-host-arcueid.oss-cn-hangzhou.aliyuncs.com/img202404081730228.png" alt="image-20240408173021178"></p>
<p>拿主机名</p>
<p><code>ip.addr eq 10.4.19.136 and ip contains &quot;DESKTOP-&quot;</code></p>
<p><img src="https://img-host-arcueid.oss-cn-hangzhou.aliyuncs.com/img202404081759020.png" alt="image-20240408175953955"></p>
<p>拿mac地址 随便找个一个和10.4.19.136相关的帧查看</p>
<p><img src="https://img-host-arcueid.oss-cn-hangzhou.aliyuncs.com/img202404081800142.png" alt="image-20240408180055105"></p>
<h1 id="答案"><a href="#答案" class="headerlink" title="答案"></a>答案</h1><p>2023-04-19 15:31:08</p>
<p>10.4.19.136 </p>
<p>14:58:d0:2e:c5:ae</p>
<p>csilva</p>
<p>Desktop</p>
<p>DESKTOP-SFF9LJF</p>
<p>BackConnect traffic</p>

    </div>
    
    
    
    
    
    
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2024 Arcueid&#39;s BLOG
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;Arcueid
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
    




    
</body>
</html>
